<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Kenyan Ministry of Health Facilities</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600' rel='stylesheet' type='text/css'>
    
    <style>
    body { 
        margin:0;
        padding:0;
        background: whitesmoke;
        font-family: "Work Sans", sans-serif; 
    }
    #map { 
        position:absolute; 
        top:0; 
        bottom:0; 
        width:100%; 
    }
    .info {
        position: absolute;
        right: 15px;
        bottom: 20px;
        padding: 8px 15px;
        background: whitesmoke;
        border: 2px solid slategray;
        border-radius: 3px;
        color: slategray;
        width: 240px;
        height: 190px;
        text-align: left
    }
    .info h3 {
        text-align: center;
        font-weight: 500;
        margin: 10px 0 20px;
    }
    #side-panel {
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 33%;
        background: whitesmoke;
        border-right: 2px solid #1C9976;
        overflow-y: scroll;
    }
    h1 {
        padding: 8px 25px 8px 15px;
        margin: 0;
        background: #1C9976;
        color: whitesmoke;
        font-weight: 400;
        font-size: 1.5em;
        text-align: right;
    }
    h2 {
        margin: 0;
        padding: 8px 25px 8px 15px;
        color: #1C9976;
        font-weight: 500;
        font-size: 1.2em;
        text-align: right;
    }
    #side-panel p {
        margin: 8px 0 4px; 
        padding: 0 25px 0 15px;
        color: #3d3d3d;
        text-align: right;
        font-size: 1em; 
    }
    #side-panel p:after {
        content: '';
        display: block;
        clear: both;
    }
    #side-panel img {
        float: right;
        margin: 0 0 15px 15px;
    }
        
    </style>
</head>
<body>
    
    <div id='map'></div>
    <div id='side-panel'>
        <h1>Student attrition rates in Kenya</h1>
            <h2>2014 enrollment rates for boys and girls</h2>
                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nam mollis laoreet elementum. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Donec mi eros, rutrum sed orci eget, venenatis varius est. Pellentesque accumsan est vitae risus malesuada fringilla.</p>
                <p><img src="images/legend.png" alt="legend"></p>
                <p>Cras at massa in leo aliquam fermentum. Nunc auctor vestibulum sagittis. Aliquam pulvinar, ipsum in pulvinar tincidunt, enim metus fermentum tellus, quis accumsan ex lorem ut ante. Phasellus fermentum orci eget interdum ultrices. Proin vitae magna id odio ultricies placerat quis id ex. Aenean volutpat volutpat gravida.</p>
            <h2>About this map</h2>
                <p>Phasellus in ante nec augue pulvinar pellentesque id vitae nunc. Donec tincidunt metus metus, sed rhoncus ex vehicula sed. Donec erat felis, dignissim bibendum metus ut, tincidunt dictum ligula. Aliquam interdum gravida enim id aliquet. Duis sed ex sed mi aliquam hendrerit. Nunc egestas in lorem ac consectetur. Donec quis rhoncus metus.</p>
            <h2>About the data</h2>
                <p>Phasellus in ante nec augue pulvinar pellentesque id vitae nunc. Donec tincidunt metus metus, sed rhoncus ex vehicula sed. Donec erat felis, dignissim bibendum metus ut, tincidunt dictum ligula. Aliquam interdum gravida enim id aliquet. Duis sed ex sed mi aliquam hendrerit. Nunc egestas in lorem ac consectetur. Donec quis rhoncus metus.</p>
    </div>

    
<script>
    L.mapbox.accessToken = 'pk.eyJ1Ijoicm9nZXJzbTYyMCIsImEiOiJjaXI5cGxkMmUwMTJ5Z2Rua296aTN3NXFuIn0.GteABPXudsE0yuZGP_vquw';
    
    var map = L.mapbox.map('map', 'mapbox.streets-satellite', {
        center: [-.23, 37.8],
        zoom: 7,
        minZoom: 6,
        maxBounds: L.latLngBounds([-6.22, 27.72],[5.76, 47.83])
    });
    
    var clincs = omnivore.csv('Health_Facilities.csv')
                    .on('ready', function(e) {
                        drawMap(e.target.toGeoJSON());  
                    })
                    .on('error', function(e) {
                        console.log(e.error[0].message);
                    });
    
    var customLayer = L.geoJson(null, {
                // http://leafletjs.com/reference.html#geojson-style
            style: function(feature) {
            return { color: '#f00' };
            }
        });
                // this can be any kind of omnivore layer
    //var runLayer = omnivore.kml('line.kml', null, customLayer)
    
    var commonStyles = {
        weight: 1,
        stroke: 1,
        fillOpacity: .6,
        radius: 5
    };
    
    function drawMap(healthData) {
        
        var keph1 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#66c2a5',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "1") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph2 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#8da0cb',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "2") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph3 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#e78ac3',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "3") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph4 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#ffd92f',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "4") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var sourcesLayers = {
            "<b style='color:#66c2a5'>KEPH 1</>": keph1,
            "<b style='color:#8da0cb'>KEPH 2</>": keph2,
            "<b style='color:#e78ac3'>KEPH 3</>": keph3,
            "<b style='color:#ffd92f; text-shadow: 0px 0px 1px #333;'>KEPH 4</>": keph4
        };
    
        L.control.layers(null, sourcesLayers, { collapsed:false }).addTo(map);
        drawInfo();
        
        keph1.eachLayer(function(layer) {
         
            layer.on('mouseover', function() {      //show info box on mouseover
                updateInfo(this);
                $(".info").show();
                
            });
            layer.on('mouseout', function() {       //remove info box on mouseout
                $(".info").hide();
                
            });
            });
        
        keph2.eachLayer(function(layer) {
         
            layer.on('mouseover', function() {      //show info box on mouseover
                updateInfo(this);
                $(".info").show();
                
            });
            layer.on('mouseout', function() {       //remove info box on mouseout
                $(".info").hide();
                
            });
            });
        
        keph3.eachLayer(function(layer) {
         
            layer.on('mouseover', function() {      //show info box on mouseover
                updateInfo(this);
                $(".info").show();
                
            });
            layer.on('mouseout', function() {       //remove info box on mouseout
                $(".info").hide();
                
            });
            });
        
        keph4.eachLayer(function(layer) {
         
            layer.on('mouseover', function() {      //show info box on mouseover
                updateInfo(this);
                $(".info").show();
                
            });
            layer.on('mouseout', function() {       //remove info box on mouseout
                $(".info").hide();
                
            });
            });
        
    }
    
    //pop up info window
    function drawInfo() {       //builds info box
            
        var info = L.control({position: 'bottomright'});       //placement
            
        info.onAdd = function(map) {
                
            var div = L.DomUtil.create('div', 'info'); //creates new div named info
                
            return div;
        }
        info.addTo(map);        //add to map
        $(".info").hide();      //hide initially
        }
        
        //update pop up info window
    function updateInfo(layer) {        //inserts updated info into info box
            
        var props = layer.feature.properties;
            
        var html = "<h3>"+ props['facilityName'] +"</h3>"+           //content
                    "County: <b>"+ props['County']+"</b><br>"+
                    "Sub-county: <b>"+ props['Division']+"</b><br>"+
                    "Ward: <b>"+ props['LOCATION']+"</b><br>"+
                    "Constituency: <b>"+ props['Constituency']+"</b><br>"+
                    "KEPH level: <b>"+ props['facilityType']+"</b>" 
            
        $(".info").html(html);      //insert content into div
    }
        
        
    
    
    
    
</script>
</body>
</html>
