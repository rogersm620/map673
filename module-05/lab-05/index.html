<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Kenyan Ministry of Health Facilities</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    
    <style>
    body { 
        margin:0; 
        padding:0; 
    }
    #map { 
        position:absolute; 
        top:0; 
        bottom:0; 
        width:100%; 
    }
        
    </style>
</head>
<body>
    
    <div id='map'></div>

    
<script>
    L.mapbox.accessToken = 'pk.eyJ1Ijoicm9nZXJzbTYyMCIsImEiOiJjaXI5cGxkMmUwMTJ5Z2Rua296aTN3NXFuIn0.GteABPXudsE0yuZGP_vquw';
    
    var map = L.mapbox.map('map', 'mapbox.streets-satellite', {
        center: [-.23, 37.8],
        zoom: 7,
        minZoom: 6,
        maxBounds: L.latLngBounds([-6.22, 27.72],[5.76, 47.83])
    });
    
    var clincs = omnivore.csv('Health_Facilities.csv')
                    .on('ready', function(e) {
                        drawMap(e.target.toGeoJSON());  
                    })
                    .on('error', function(e) {
                        console.log(e.error[0].message);
                    });
    
    var customLayer = L.geoJson(null, {
                // http://leafletjs.com/reference.html#geojson-style
            style: function(feature) {
            return { color: '#f00' };
            }
        });
                // this can be any kind of omnivore layer
    //var runLayer = omnivore.kml('line.kml', null, customLayer)
    
    var commonStyles = {
        weight: 1,
        stroke: 1,
        fillOpacity: .6,
        radius: 5
    };
    
    function drawMap(healthData) {
        
        var keph1 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#66c2a5',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "1") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph2 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#8da0cb',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "2") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph3 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#e78ac3',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "3") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var keph4 = L.geoJson(healthData, {
                pointToLayer: function(feature, layer){
                    return L.circleMarker(layer, {
                        color: '#ffd92f',
                        opacity: .6,
                        weight: 2,
                        fillOpacity: .4,
                        radius: 5
                    });
                },
            
                filter: function(feature) {
                if(feature.properties.facilityType == "4") {
                    return feature;
                }
            }
            }).addTo(map);
        
        var sourcesLayers = {
            "<b style='color:#66c2a5'>KEPH 1</>": keph1,
            "<b style='color:#8da0cb'>KEPH 2</>": keph2,
            "<b style='color:#e78ac3'>KEPH 3</>": keph3,
            "<b style='color:#ffd92f; text-shadow: 0px 0px 1px #333;'>KEPH 4</>": keph4
        };
    
        L.control.layers(null, sourcesLayers, { collapsed:false }).addTo(map);
        
    }
        
        
    
    
    
    
</script>
</body>
</html>
