<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Kenyan Ministry of Health Facilities</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.js'></script>
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.2.0/leaflet-omnivore.min.js'></script>
    
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
    
    <style>
    body { 
        margin:0; 
        padding:0; 
    }
    #map { 
        position:absolute; 
        top:0; 
        bottom:0; 
        width:100%; 
    }
        
    </style>
</head>
<body>
    
    <div id='map'></div>

    
<script>
    L.mapbox.accessToken = 'pk.eyJ1Ijoicm9nZXJzbTYyMCIsImEiOiJjaXI5cGxkMmUwMTJ5Z2Rua296aTN3NXFuIn0.GteABPXudsE0yuZGP_vquw';
    
    var map = L.mapbox.map('map', 'mapbox.streets-satellite', {
        center: [-.23, 37.8],
        zoom: 7,
        minZoom: 6,
        maxBounds: L.latLngBounds([-6.22, 27.72],[5.76, 47.83])
    });
    
    var clincs = omnivore.csv('Health_Facilities.csv')
                    .on('ready', function(e) {
                       var healthData = e.target.toGeoJSON();
                        
                        for(var layer in layerInfo) {
                            sites = L.geoJson(healthData, {
                                pointToLayer: function(feature, layer) {
                                return L.circleMarker(layer, commonStyles);
                            },
                                filter: function(feature) {
                                if(feature.properties[layerInfo[layer].facilityType]) {
                                return feature;
                                }
                            },
                                style: function(features) {
                                        return {
                                            color: layerInfo[layer].color,
                                            fillcolor: layerInfo[layer].color
                                        }
                                    }
                            }).addTo(map);
        
        
                        }
                        
                        
                    })
                    .on('error', function(e) {
                        console.log(e.error[0].message);
                    });
    
    var customLayer = L.geoJson(null, {
                // http://leafletjs.com/reference.html#geojson-style
            style: function(feature) {
            return { color: '#f00' };
            }
        });
                // this can be any kind of omnivore layer
    //var runLayer = omnivore.kml('line.kml', null, customLayer)
    
    var healthLayers = {};
    
    var commonStyles = {
        weight: 1,
        stroke: 1,
        fillOpacity: .6,
        radius: 5
    };
    
    var layerInfo = {
        keph1: {facilityType: "1", color: 'limegreen'},
        keph2: {facilityType: "2", color: 'pink'},
        keph3: {facilityType: "3", color: 'yellow'},
        keph4: {facilityType: "4", color: 'blue'}
    };
    
    
        
        
    
    
    
    
</script>
</body>
</html>
